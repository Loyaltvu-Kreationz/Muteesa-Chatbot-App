<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>University Landing Page</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #f0f4f8;
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #1e3c72;
            color: white;
            padding: 10px 20px;
        }
        .navbar .logo {
            width: 50px;
            height: 50px;
            background-color: white;
            margin-left: 5px;
            margin-top: 0px;
            border-radius: 50%;
            background-image: url('static/university_logo.png'); 
            background-size: cover;
            background-position: center;
        }
        .navbar nav a {
            color: white;
            text-decoration: none;
            margin: 0 15px;
        }
        .slider {
            position: relative;
            max-width: 100%;
            max-height: 300px;
            overflow: hidden;
        }
        .slides {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }
        .slide {
            min-width: 20%;
            box-sizing: border-box;
        }
        .slide img {
            width: auto;
            vertical-align: top;
        }
        .caption {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
        }
        .content {
            padding: 20px;
        }
        .footer {
            background-color: #1e3c72;
            color: white;
            text-align: center; 
            padding: 10px 0;
            position: relative;
            bottom: 0;
            width: 100%;
        }
        .chat-icon {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #ff6b6b;
            color: white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 24px;
            z-index: 1000;
            transition: width 0.3s, height 0.3s;
        }
        .chat-icon span {
            display: none;
            position: absolute;
            bottom: 60px;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            white-space: nowrap;
        }
        .chat-icon:hover {
            width: auto;
            height: auto;
            padding: 10px;
        }
        .chat-icon:hover span {
            display: block;
        }
        .chat-login {
            display: none;
            position: fixed;
            bottom: 90px; /* above the icon*/
            right: 20px;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            width: 300px;
            height: 400px;
            z-index: 1001;
        }
         .login-head {
            margin-top: -5px;
            padding: 20px 20px;
            height: 10vh;
            display: flex;
            flex-direction: row;
            align-items: center;
            background-color: #1e3c72;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
        }
        .login-logo{
            width: 50px;
            height: 50px;
            background-color: white;
            margin-left: 1px;
            margin-top: 1px;
            border-radius: 50%;
            background-image: url('static/university_logo.png'); 
            background-size: cover;
            background-position: center;
        }
        .login-title{
            width: 80%;
            height: 9vh;
            margin-left: 5px;
            color: white;
            margin-top: -5px;
        }

        .bot-head, logo-head {
            margin-top: 0;
            color: white;
            background-color: #1e3c72;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
           display: flex;
           flex-direction: column;
        }
        .top-head{
            height: 40px;
            display: flex;
            flex-direction: row;
        }
        .bot-name{
            width: 80%;
            margin-left: 20px;
        }
        .bot-logo{
            width: 18%;
            height: 50px;
            background-color: white;
            margin-top: 10px;
            border-radius: 50%;
            background-image: url('static/university_logo.png'); 
            background-size: cover;
            background-position: center;
            margin-left: 10px;
        }
     
        .bot-tagline{
            width: 100%;;
        }
        .out {
            background-color: white;
            color: #1e3c72;
            padding: 10px 10px;
            border-radius: 5px;
            text-decoration: none;
            height: 15px;
            width: 12%;
            margin: 20px;
            margin-right: 5px;
            margin-left: 5px;
            transition: background-color 0.3s, color 0.3s;
        }
        .out:hover {
            background-color: #ccc;
            color: white;
        }
        .out a{
            text-decoration: none;
        }
        .tagline{
            height: 20px;
            background-color: red;
            color: white;
            margin-top: 0;
            margin-left: 40px;
        }
        .chat-login input {
            width: calc(95% - 40px);
            padding: 10px;
            margin: 10px 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .chat-area input[type="text"] {
            width: calc(95% - 40px);
            padding: 10px;
            margin: 10px 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .chat-login button {
            width: calc(100% - 40px);
            padding: 10px;
            margin: 10px 20px;
            background-color: #1e3c72;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

       /* CHAT AREA STYLING */

        .chat-area {
            display: none;
            position: fixed;
            bottom: 80px;
            right: 20px;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
            width: 400px;
            height: 550px;
            z-index: 1001;
        }
       
        .messages {
            padding: 20px;
            height: 350px; /* Set a fixed height for the chat area */
            overflow-y: scroll;
            border-bottom: 1px solid #ccc;
        }
        .chat-area .messages div {
            margin-bottom: 10px;
            width: 100%;
            box-sizing: border-box;
        }
        .chat-area .messages .user-message {
            text-align: right;
        }
        .chat-area .messages .chatbot-message {
            text-align: left;
        }
        .input-container {
            display: flex;
            padding: 10px;
            background-color: #f0f4f8;
        }
        #chatInput {
            flex: 1;
            padding: 10px;
            width: 90%;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        #sendbtn {
            color: black;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            width: 50px;
            height: 40px;
            margin-top: 10px;
            margin-left: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #fff;
            font-size: 24px;
            padding: 10px;
            transition: background-color 0.3s, transform 0.3s;
        }
        #sendbtn:hover {
            background-color: #ccc;
            transform: scale(1.1);
        }
        .send-icon {
            color: black;
            font-size: 24px;
            transition: color 0.3s;
        }
        #sendbtn:hover .send-icon {
            color: white;
        }
        .message {
            position: relative;
            max-width: 100%;
            width: 80%; /* Ensures the message div takes the same width as the messages div */
            word-wrap: break-word;
            display: flex;
            align-items: center;
            padding: 10px;
            box-sizing: border-box;
        }
        .user-message .message-content, .chatbot-message .message-content {
            display: inline-block;
        }
        .user-message {
            align-self: flex-end;
            background-color: #007bff;
            color: white;
            text-align: right;
            border-bottom-left-radius: 15px;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
            padding: 10px;
        }
        .user-message img {
            height: 40px;
            width: 40px;
            margin-right: 1px;
            margin-left: 10px;
        }
        .chatbot-message {
            align-self: flex-start;
            background-color: #d3d3d3;
            color: black;
            text-align: left;
            padding: 10px;
            border-bottom-right-radius: 15px;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
            padding: 10px;
        }
        .chatbot-message img {
            height: 30px;
            width: 30px;
            margin-left: 0px;
            margin-right: 2px;
        }
        /* Make scrollbar always visible */
        .chat-area .messages::-webkit-scrollbar {
            width: 10px;
        }
        .chat-area .messages::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .chat-area .messages::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .chat-area .messages::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

    
        
    </style>
</head>
<body>
    <div class="navbar">
        <img src="static\university_logo.png" alt="University Logo" class="logo">
        <nav>
            <a href="#">Home</a>
            <a href="#">About</a>
            <a href="#">Admissions</a>
            <a href="#">Departments</a>
            <a href="#">Contact</a>
        </nav>
    </div>

    <div class="slider">
        <div class="slides">
            <div class="slide">
                <img src="static/slide1.jpg" alt="Campus Image 1">
                <div class="caption">Welcome to MRU University</div>
            </div>
            <div class="slide">
                <img src="static/slide2.jpg" alt="Campus Image 2">
                <div class="caption">Innovative Learning</div>
            </div>
            <div class="slide">
                <img src="static/slide3.jpg" alt="Campus Image 3">
                <div class="caption">Join MRU Community</div>
            </div>
        </div>
    </div>

    <div class="content">
        <h1>Welcome to Muteesa I Royal University   2021000822</h1>
        <p>Our university offers a wide range of programs and opportunities for students from around the world. Explore our website to learn more about our academic offerings, campus life, and admissions process. We are committed to providing a high-quality education and a supportive learning environment.</p>
    </div>

    <div class="footer">
        <p>&copy; Ssekandi Steven 2021000822 @ Mutessa I Royal University 2024. All rights reserved.</p>
    </div>

    <div class="chat-icon" onclick="toggleChatLogin()">
        ðŸ’¬ 
        <span>Student Chatbot</span>
    </div>

    <div class="chat-login" id="chatLogin">
        <div class="login-head">
            <div class="login-logo">        </div>
            <div class="login-title">
                    <center>
                        <p>
                            MRU SUPPORT CHATBOT
                            <hr>
                            Login Now
                        </p>
                    </center>
            </div>
        </div>

        <br>
        <input type="text" id="loginUsername" placeholder="Username" required>
        <label class="spacce"></label>
        <input type="password" id="loginPassword" placeholder="Password" required>
        <button type="button" onclick="login()">Login</button>
        <center> <p id="loginError" style="color: red; display: none; margin-left: 20px; margin-right: 20px;">Invalid username or password. Please try again.</p> </center>
    </div>

    <div class="chat-area" id="chatArea">
        <div class="bot-head">  
            <div class="top-head">
                
                <div class="bot-logo">    </div>
                <div class="bot-name"> <center><h2>MRU CHATBOT<hr></h2></center> </div>
                <div class="out"> <center>  <a href="{{ url_for('logout') }}" class="logout">Logout</a></center> </div>
            </div>
            <br>
            <div class="bot-tagline"><center><p>Providing Genuine Assistance/Support to Students</p></center> </div>  
        </div>
        <div class="messages" id="messages">
            <!-- Chat messages will go here -->
        </div>
        <div class="input-container">
            <input type="text" id="chatInput" placeholder="Type your message here...">
            <button id="sendbtn" onclick="sendMessage()">
                <span class="send-icon">&#10148;</span>
            </button>
        </div>
    </div>

<script>
    let currentIndex = 0;
    const slides = document.querySelector('.slides');
    const slideCount = slides.children.length;

    setInterval(() => {
        currentIndex = (currentIndex + 1) % slideCount;
        slides.style.transform = `translateX(${-currentIndex * 100}%)`;
    }, 3000);

       // Track login status
let isLoggedIn = false;

// Function to toggle chat login and chat area visibility
function toggleChatLogin() {
    const chatLogin = document.getElementById('chatLogin');
    const chatArea = document.getElementById('chatArea');

    // Check if user is logged in
    if (!isLoggedIn) {
        // User is not logged in, show login form
        chatLogin.style.display = 'block';
        chatArea.style.display = 'none';
    } else {
        // User is logged in, show chat area
        chatLogin.style.display = 'none';
        chatArea.style.display = 'block';
    }
}

// Function to handle login
function login() {
    const username = document.getElementById('loginUsername').value;
    const password = document.getElementById('loginPassword').value;
    const loginError = document.getElementById('loginError');

    fetch('/user_login', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: `username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Login successful, update isLoggedIn status
            isLoggedIn = true;
            document.getElementById('chatLogin').style.display = 'none';
            document.getElementById('chatArea').style.display = 'block';
            loginError.style.display = 'none';
        } else {
            // Login failed, show error message
            loginError.style.display = 'block';
        }
    })
    .catch(error => console.error('Error:', error));
}

// Ensure chat-area remains hidden on page load until login
document.addEventListener('DOMContentLoaded', function() {
    const chatArea = document.getElementById('chatArea');
    chatArea.style.display = 'none';
});


        function sendMessage() {
            var chatInput = document.getElementById("chatInput").value.trim();

            if (chatInput === "") {
                return;
            }

            var userMessageElement = document.createElement("div");
            userMessageElement.classList.add("message", "user-message");
            userMessageElement.innerHTML = '<div class="message-content">' + chatInput + '</div><img class="user-icon" src="static/user_icon.png" alt="User Icon">';

            var messages = document.getElementById("messages");
            messages.appendChild(userMessageElement);

            document.getElementById("chatInput").value = "";

            messages.scrollTop = messages.scrollHeight;

            fetch('/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ message: chatInput })
            })
            .then(response => response.json())
            .then(data => {
                var chatbotResponse = data.response;

                var chatbotMessageElement = document.createElement("div");
                chatbotMessageElement.classList.add("message", "chatbot-message");
                chatbotMessageElement.innerHTML = '<img class="chatbot-icon" src="static/chatbot_icon.png"  alt="Chatbot Icon"><div class="message-content">' + chatbotResponse + '</div>';

                messages.appendChild(chatbotMessageElement);

                messages.scrollTop = messages.scrollHeight;
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</body>
</html>
